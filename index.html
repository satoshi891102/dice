<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dice Roller</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#1a1a2e;--surface:#16213e;--surface2:#0f3460;--accent:#e94560;--accent2:#ff6b6b;--text:#eee;--text2:#aaa;--gold:#ffd700;--radius:12px}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.container{max-width:600px;margin:0 auto;padding:16px}
h1{text-align:center;font-size:1.8rem;margin:12px 0;background:linear-gradient(135deg,var(--accent),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:none}
.subtitle{text-align:center;color:var(--text2);font-size:.8rem;margin-bottom:16px;letter-spacing:2px;text-transform:uppercase}

/* Controls */
.controls{background:var(--surface);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.row{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
.row:last-child{margin-bottom:0}
label{font-size:.85rem;color:var(--text2);min-width:70px}
select,input[type=number]{background:var(--surface2);color:var(--text);border:1px solid #333;border-radius:8px;padding:8px 12px;font-size:1rem;outline:none}
select{flex:1;min-width:0}
input[type=number]{width:70px;text-align:center}
input[type=number]::-webkit-inner-spin-button{opacity:1}

/* Buttons */
.btn{border:none;border-radius:8px;padding:10px 16px;font-size:.95rem;font-weight:600;cursor:pointer;transition:transform .1s,box-shadow .15s;user-select:none}
.btn:active{transform:scale(.95)}
.btn-roll{background:linear-gradient(135deg,var(--accent),#c0392b);color:#fff;width:100%;font-size:1.2rem;padding:14px;box-shadow:0 4px 15px rgba(233,69,96,.4)}
.btn-roll:hover{box-shadow:0 6px 25px rgba(233,69,96,.6)}
.btn-quick{background:var(--surface2);color:var(--text);font-size:.8rem;padding:8px 12px;border:1px solid #333}
.btn-quick:hover{border-color:var(--accent)}
.btn-clear{background:transparent;color:var(--text2);font-size:.75rem;padding:6px 10px;border:1px solid #444}

/* Dice Display */
.dice-area{min-height:120px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:12px;margin:16px 0;perspective:600px}
.die{width:64px;height:64px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;border-radius:12px;background:linear-gradient(145deg,#2a2a4a,#1a1a3a);border:2px solid var(--accent);color:var(--gold);box-shadow:0 4px 15px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.1);position:relative}
.die.rolling{animation:diceRoll .5s ease-out}
.die.nat20{border-color:var(--gold);box-shadow:0 0 20px rgba(255,215,0,.6)}
.die.nat1{border-color:#666;color:#666}
.die-label{position:absolute;top:-8px;right:-8px;background:var(--accent);color:#fff;font-size:.55rem;padding:2px 5px;border-radius:6px;font-weight:700}

@keyframes diceRoll{
  0%{transform:rotateX(0) rotateY(0) scale(.5);opacity:.3}
  25%{transform:rotateX(180deg) rotateY(90deg) scale(1.1)}
  50%{transform:rotateX(360deg) rotateY(180deg) scale(.9)}
  75%{transform:rotateX(540deg) rotateY(270deg) scale(1.05)}
  100%{transform:rotateX(720deg) rotateY(360deg) scale(1)}
}

/* Results */
.total-display{text-align:center;font-size:2.5rem;font-weight:700;color:var(--gold);margin:8px 0;min-height:3rem}
.total-detail{text-align:center;font-size:.85rem;color:var(--text2);margin-bottom:12px;min-height:1.2rem}

/* Quick Rolls */
.quick-rolls{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}

/* Stats */
.stats{background:var(--surface);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.stat{text-align:center}
.stat-val{font-size:1.2rem;font-weight:700;color:var(--accent2)}
.stat-label{font-size:.65rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px}

/* History */
.history{background:var(--surface);border-radius:var(--radius);padding:12px 16px}
.history-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.history-header h3{font-size:.9rem;color:var(--text2)}
.history-list{max-height:300px;overflow-y:auto}
.history-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #1a1a2e;font-size:.85rem}
.history-item:last-child{border:none}
.history-roll{color:var(--text2)}
.history-result{font-weight:600;color:var(--gold)}
.history-note{color:var(--accent);font-size:.75rem}

.shake-hint{text-align:center;color:var(--text2);font-size:.7rem;margin-top:12px;opacity:.6}

/* Scrollbar */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#333;border-radius:2px}

@media(max-width:400px){
  .die{width:52px;height:52px;font-size:1.2rem}
  .stats{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="container">
  <h1>‚öîÔ∏è Dice Roller</h1>
  <p class="subtitle">Roll the bones</p>

  <div class="controls">
    <div class="row">
      <label>Count</label>
      <input type="number" id="count" min="1" max="10" value="1">
      <label style="min-width:40px">Type</label>
      <select id="dtype">
        <option value="4">d4</option>
        <option value="6" selected>d6</option>
        <option value="8">d8</option>
        <option value="10">d10</option>
        <option value="12">d12</option>
        <option value="20">d20</option>
        <option value="100">d100</option>
      </select>
    </div>
    <button class="btn btn-roll" id="rollBtn" onclick="roll()">üé≤ Roll</button>
  </div>

  <div class="quick-rolls">
    <button class="btn btn-quick" onclick="quickRoll(2,6)">2d6</button>
    <button class="btn btn-quick" onclick="quickRoll(1,20)">1d20</button>
    <button class="btn btn-quick" onclick="quickRoll(1,100)">1d100</button>
    <button class="btn btn-quick" onclick="roll4d6drop()">4d6 drop low</button>
    <button class="btn btn-quick" onclick="quickRoll(2,10)">2d10</button>
    <button class="btn btn-quick" onclick="quickRoll(8,6)">8d6</button>
  </div>

  <div class="dice-area" id="diceArea"></div>
  <div class="total-display" id="totalDisplay"></div>
  <div class="total-detail" id="totalDetail"></div>

  <div class="stats" id="statsPanel" style="display:none">
    <div class="stat"><div class="stat-val" id="statRolls">0</div><div class="stat-label">Rolls</div></div>
    <div class="stat"><div class="stat-val" id="statAvg">0</div><div class="stat-label">Average</div></div>
    <div class="stat"><div class="stat-val" id="statMin">0</div><div class="stat-label">Min</div></div>
    <div class="stat"><div class="stat-val" id="statMax">0</div><div class="stat-label">Max</div></div>
  </div>

  <div class="history">
    <div class="history-header">
      <h3>Roll History</h3>
      <button class="btn btn-clear" onclick="clearHistory()">Clear</button>
    </div>
    <div class="history-list" id="historyList">
      <div style="color:#555;text-align:center;padding:20px;font-size:.85rem">No rolls yet</div>
    </div>
  </div>
  <p class="shake-hint">üì± Shake device to roll</p>
</div>

<script>
const history=[];
const allTotals=[];
let audioCtx=null;

function getAudio(){
  if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  return audioCtx;
}

function playClick(){
  try{
    const ctx=getAudio();
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.connect(g);g.connect(ctx.destination);
    o.frequency.value=800;
    o.type='square';
    g.gain.value=0.08;
    g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.08);
    o.start(ctx.currentTime);
    o.stop(ctx.currentTime+0.08);
  }catch(e){}
}

function rollDie(sides){return Math.floor(Math.random()*sides)+1}

function roll(n,s){
  n=n||parseInt(document.getElementById('count').value);
  s=s||parseInt(document.getElementById('dtype').value);
  n=Math.max(1,Math.min(10,n));
  const results=[];
  for(let i=0;i<n;i++) results.push(rollDie(s));
  showResults(results,s,n+'d'+s);
}

function quickRoll(n,s){
  document.getElementById('count').value=n;
  document.getElementById('dtype').value=s;
  roll(n,s);
}

function roll4d6drop(){
  const results=[];
  for(let i=0;i<4;i++) results.push(rollDie(6));
  const sorted=[...results].sort((a,b)=>a-b);
  const dropped=sorted[0];
  const kept=sorted.slice(1);
  const total=kept.reduce((a,b)=>a+b,0);

  showResults(results,6,'4d6 drop lowest',{dropped,total,kept});
}

function showResults(results,sides,label,special){
  playClick();
  const area=document.getElementById('diceArea');
  area.innerHTML='';

  results.forEach((val,i)=>{
    const d=document.createElement('div');
    d.className='die rolling';
    d.innerHTML=`${val}<span class="die-label">d${sides}</span>`;
    if(sides===20&&val===20) d.classList.add('nat20');
    if(sides===20&&val===1) d.classList.add('nat1');
    d.style.animationDelay=(i*0.07)+'s';
    area.appendChild(d);
  });

  let total,detail='';
  if(special){
    total=special.total;
    detail=`[${results.join(', ')}] ‚Äî dropped ${special.dropped} ‚Äî kept [${special.kept.join(', ')}]`;
  }else{
    total=results.reduce((a,b)=>a+b,0);
    if(results.length>1) detail=`[${results.join(' + ')}]`;
    if(results.length===1&&sides===20){
      if(results[0]===20) detail='‚ú® Natural 20!';
      else if(results[0]===1) detail='üíÄ Natural 1...';
    }
  }

  document.getElementById('totalDisplay').textContent=total;
  document.getElementById('totalDetail').textContent=detail;

  allTotals.push(total);
  updateStats();
  addHistory(label,results,total,special);
}

function updateStats(){
  if(!allTotals.length) return;
  document.getElementById('statsPanel').style.display='';
  document.getElementById('statRolls').textContent=allTotals.length;
  document.getElementById('statAvg').textContent=(allTotals.reduce((a,b)=>a+b,0)/allTotals.length).toFixed(1);
  document.getElementById('statMin').textContent=Math.min(...allTotals);
  document.getElementById('statMax').textContent=Math.max(...allTotals);
}

function addHistory(label,results,total,special){
  history.unshift({label,results,total,special,time:new Date()});
  if(history.length>20) history.pop();
  renderHistory();
}

function renderHistory(){
  const el=document.getElementById('historyList');
  if(!history.length){el.innerHTML='<div style="color:#555;text-align:center;padding:20px;font-size:.85rem">No rolls yet</div>';return}
  el.innerHTML=history.map(h=>{
    const t=h.time.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    const note=h.special?'(drop low)':'';
    return `<div class="history-item"><span class="history-roll">${t} ‚Äî ${h.label} ${note}</span><span class="history-result">${h.total}</span></div>`;
  }).join('');
}

function clearHistory(){
  history.length=0;
  allTotals.length=0;
  renderHistory();
  document.getElementById('statsPanel').style.display='none';
  document.getElementById('totalDisplay').textContent='';
  document.getElementById('totalDetail').textContent='';
  document.getElementById('diceArea').innerHTML='';
}

// Keyboard
document.addEventListener('keydown',e=>{if(e.code==='Space'||e.code==='Enter'){e.preventDefault();roll()}});

// Shake to roll
let lastShake=0;
window.addEventListener('devicemotion',e=>{
  const a=e.accelerationIncludingGravity;
  if(!a) return;
  const force=Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z);
  if(force>35&&Date.now()-lastShake>800){
    lastShake=Date.now();
    roll();
  }
});
</script>
</body>
</html>
